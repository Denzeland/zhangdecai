---
title: Linux系统的启动过程
date: 2019-10-16 22:56:13
tags:
- Linux
---

## Linux系统的启动过程

Linux系统的启动过程是一个非常复杂的过程， 总体概括起来包括内核的启动和用户空间的启动。自底向上的启动过程是BIOS-引导装载程序-内核-init进程-其他用户进程，下面简要概述这两部分的启动过程：

### 内核的启动

内核的启动核心在于引导装载程序，是引导装载程序把内核加载进内存后启动的。引导装载程序启动内核的方式有MBR启动和UEFI启动（因为硬盘有这两种分区方式）， Linux引导装载程序的核心功能如下：

- 从多个内核中选择一个使用
- 从多个内核参数集中选择一个使用
- 允许用户手动更改内核映像名和参数（例如使用单用户模式）
- 支持其他操作系统的启动

下面以引导程序GRUB为例，概述引导装载程序的工作原理，也就是引导装载程序启动内核的细节：

- BIOS或者固件初始化硬件，在启动存储设备上寻找启动代码
- BIOS和固件运行找到的启动代码，开始GRUB
- 加载GRUB核心
- 初始化GRUB核心，此时GRUB可以读取磁盘和文件系统
- GRUB识别启动分区，在那里加载配置信息
- GRUB为用户提供一个更改配置的机会
- GRUB为用户提供一个更改配置的机会
- 执行过程当中， GRUB可能会在启动分区中加载额外的代码（模块）
- GRUB执行boot命令，以加载和执行配置信息中linux命令指定的内核

### 用户空间启动

用户空间大致按下面的顺序启动：
1. init（有三种主要的实现版本，System V init如Debian，systemd如centos，Upstart如Ubuntu）
2. 基础的底层服务，如udevd和syslogd
3. 网络配置
4. 中高层服务，如cron和打印服务等
5. 登录提示符、 GUI及其他应用程序

总结系统的启动过程就是：

1. BIOS或者启动固件加载并运行引导装载程序
2. 引导装载程序在磁盘上找到内核映像，将其载入内存并启动。
3. 内核初始化设备及其驱动程序。
4. 内核挂载root文件系统内核使用PID 1来运行一个叫init的程序， 用户空间在此时开始启动。
5. init启动其他的系统进程。
6. init还会启动一个进程，通常发生在整个过程的尾声，负责用户登录